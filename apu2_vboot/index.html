
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="http://pcengines.github.io/apu2-documentation/apu2_vboot/">
      
      
        <link rel="prev" href="../APU_mPCIe_capabilities/">
      
      
        <link rel="next" href="../apu2_vs_apu3/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>Vboot measured boot on apu2 - apu2 Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a40c8224.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#vboot-measured-boot-on-apu2" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="apu2 Documentation" class="md-header__button md-logo" aria-label="apu2 Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            apu2 Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Vboot measured boot on apu2
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="apu2 Documentation" class="md-nav__button md-logo" aria-label="apu2 Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    apu2 Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../apu_CPU_boost/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    APU Core Performance Boost
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../apu_ecc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Issues with ECC enabling
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../apu_flashing_ipxe/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PC Engines APUx flashing with iPXE usage
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../apu_flashing_with_rpi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flashing APUx with Raspberry Pi
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../APU_mPCIe_capabilities/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    APU mPCIe capabilities
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Vboot measured boot on apu2
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Vboot measured boot on apu2
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#building-coreboot-image" class="md-nav__link">
    <span class="md-ellipsis">
      Building coreboot image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-custom-keys" class="md-nav__link">
    <span class="md-ellipsis">
      Using custom keys
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advantages-of-vboot" class="md-nav__link">
    <span class="md-ellipsis">
      Advantages of vboot
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advantages of vboot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-check-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      How to check it works
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../apu2_vs_apu3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Apu2 vs apu3
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../apu2_vs_apu4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Apu2 vs apu4
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cbmem_building/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coreboot cbmem building
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cold_reset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Performing cold reset remotely
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../firmware_flashing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Firmware flashing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../flashrom_building/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flashrom building
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../generating_coreboot_support_logs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generating coreboot support logs and sending them for verification purposes
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../gpios/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    APU GPIO tutorial
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ipxe_compile/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ipxe compile
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../linux_issues/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Known issues with Linux
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../microcode_patching/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Microcode patching on PC Engines apu2/3/4/5
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../mpcie_modules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    List of supported mPCIe modules
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../order_of_PCI_addresses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Order of PCI addresses
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../os_boot_serial_console/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Enabling OS boot serial console and setting connection parameters
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../os-status/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tested operating systems
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../pfsense_installerconfig/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unattended installation PFSense
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../pfSense-install-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pfSense Installation Guide
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../pxelinux-cfg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pxelinux cfg
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_process/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Release process
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sd_card_performance_test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sd card performance test
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../serial_console/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Serial console output in coreboot
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../supported_coreboot_build/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building firmware supported by coreboot
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../theory-of-operation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    apu features - theory of operation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tianocore_build/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coreboot with tianocore payload on apu2
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tpm_menu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SeaBIOS TPM configuration menu
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tpm_pin_mapping/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pin mapping
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../voyage_image_building_alix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building Voyage Linux image for PC Engines ALIX platforms
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../voyage_linux_netinst/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuring Voyage Linux netinst
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../voyage_linux_sd_card_install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Voyage linux sd card install
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../power_consumption_testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Power Consumption Testing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_37" >
        
          
          <label class="md-nav__link" for="__nav_37" id="__nav_37_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    debug
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_37_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_37">
            <span class="md-nav__icon md-icon"></span>
            debug
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/AGESA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AGESA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/alix3d2_issue/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Issue description of PC Engines ALIX2D3 board
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/cpu_frequency/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debug notes for CPU frequency issues
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/debian_kernel_rebuild/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debian kernel rebuild
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/external_sd_slot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    External sd slot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/freeDOS_problems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Problems with FreeDOS on APU2 platform
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/hdd_mPCIe_log_analyze/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hdd mPCIe log analyze
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/hdd_test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hdd test
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/iommu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AMD I/O Virtualization Technology (IOMMU)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/mpcie_ethernet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mpcie ethernet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/mpcie1_mpcie2_ethernet_card/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Problems with APU2 when using Mini PCI-Express Dual Gigabit Ethernet Controller Card
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/mpcie2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ASM1061 in the J13 slot problems
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/openwrt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Openwrt booting from SD card issue
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/pfsense-ahci-issue/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pfSense installation tests
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/sd_registers_bad/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sd registers bad
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/sdcard_debug/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sdcard debug
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/sdcard_test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sdcard test
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/tplink_hg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tplink hg
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/tpm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TPM support for apu platforms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/usb-debugging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    apu2 USB xHCi debugging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/usb-sticks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    USB sticks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/usb-tests/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    USB tests
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/warmboot_reset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Doubled sign of life
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_38" >
        
          
          <label class="md-nav__link" for="__nav_38" id="__nav_38_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    research
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_38_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_38">
            <span class="md-nav__icon md-icon"></span>
            research
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../research/apu_bios_write_protect/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BIOS write protect
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../research/early-cbmem-implementation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Early cbmem implementation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../research/fast_boot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PC Engines fast boot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../research/freebsd_tpm_support/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FreeBSD TPM2.0 support
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../research/geode_lx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ALIX and AMD Geode LX
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../research/Orange_Pi_flasher/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Orange Pi flasher
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../research/power-consumption-tests/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PC Engines apu3 power consumption tests
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../research/ROCA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ROCA TPM vulnerability verification and status
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../research/RPI_SPI_flasher/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RPI flasher
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../research/tpm2-triage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Report of TPM2 support
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../research/USB_compliance_test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    USB compliance tests
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#building-coreboot-image" class="md-nav__link">
    <span class="md-ellipsis">
      Building coreboot image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-custom-keys" class="md-nav__link">
    <span class="md-ellipsis">
      Using custom keys
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advantages-of-vboot" class="md-nav__link">
    <span class="md-ellipsis">
      Advantages of vboot
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advantages of vboot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-check-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      How to check it works
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="vboot-measured-boot-on-apu2">Vboot measured boot on apu2</h1>
<p>This document describes a procedure of building a coreboot image for apu2 with
vboot support and measured boot utilizing a TPM module. Procedure will work
only on apu2 versions v4.9.0.6 and newer.</p>
<h2 id="building-coreboot-image">Building coreboot image</h2>
<ol>
<li>Clone the <a href="https://github.com/pcengines/pce-fw-builder">pce-fw-builder</a></li>
<li>
<p>Pull or <a href="https://github.com/pcengines/pce-fw-builder#building-docker-image">build</a>
    docker container:</p>
<div class="highlight"><pre><span></span><code>docker pull pcengines/pce-fw-builder
</code></pre></div>
</li>
<li>
<p>Build v4.9.0.6 image:</p>
<div class="highlight"><pre><span></span><code>./build.sh release v4.9.0.6 apu2
</code></pre></div>
</li>
<li>
<p>Invoke distclean:</p>
<div class="highlight"><pre><span></span><code>./build.sh dev-build $PWD/release/coreboot apu2 distclean
</code></pre></div>
</li>
<li>
<p>Copy the vboot miniconfig:</p>
<div class="highlight"><pre><span></span><code>cp $PWD/release/coreboot/configs/config.pcengines_apu2_vboot $PWD/release/coreboot/.config
</code></pre></div>
</li>
<li>
<p>Create full config:</p>
<div class="highlight"><pre><span></span><code>./build.sh dev-build $PWD/release/coreboot apu2 olddefconfig
</code></pre></div>
</li>
<li>
<p>Build the image again:</p>
<div class="highlight"><pre><span></span><code>./build.sh dev-build $PWD/release/coreboot apu2 CPUS=$(nproc)
</code></pre></div>
</li>
<li>
<p>Flash the new image. The firmware image can be found in
    <code>release/coreboot/build</code> which is relative to cloned <code>pce-fw-builder</code>
    directory.</p>
</li>
</ol>
<h2 id="using-custom-keys">Using custom keys</h2>
<p>The config file present in repository builds the binary with default vboot
developer keys. If one would like to use own keys, vboot has bash scripts that
simplify the key generation process.</p>
<ol>
<li>
<p>Enter previously cloned coreboot directory and change directory to vboot:</p>
<div class="highlight"><pre><span></span><code>cd $PWD/release/coreboot/3rdparty/vboot
</code></pre></div>
</li>
<li>
<p>Compile and install the vboot library (outside docker on the host):</p>
<div class="highlight"><pre><span></span><code>make
DESTDIR=/usr sudo make install
</code></pre></div>
</li>
<li>
<p>Then invoke from <code>$PWD/release/coreboot</code>:</p>
<div class="highlight"><pre><span></span><code>3rdparty/vboot/scripts/keygeneration/create_new_keys.sh --4k --4k-root --output keys
</code></pre></div>
<p>This script will produce whole set of new random keys in the <code>keys</code> directory.
In order to use them, follow the procedure described previously, but:</p>
</li>
<li>
<p>Create full config:</p>
<div class="highlight"><pre><span></span><code>./build.sh dev-build $PWD/release/coreboot apu2 olddefconfig
</code></pre></div>
</li>
<li>
<p>Enter menuconfig:</p>
<div class="highlight"><pre><span></span><code>./build.sh dev-build $PWD/release/coreboot apu2 menuconfig
</code></pre></div>
</li>
<li>
<p>Enter Security -&gt; Verified boot (vboot) -&gt; Vboot keys. Change the directories:</p>
<div class="highlight"><pre><span></span><code>$(VBOOT_SOURCE)/tests/devkeys/some_key.vbpubk ----&gt; $(top)/some_key.vbpubk
</code></pre></div>
</li>
<li>
<p>Do the change for all 4 key paths, but do not change the filename (generated
    keys have the same names):</p>
<div class="highlight"><pre><span></span><code>($(VBOOT_SOURCE)/tests/devkeys/root_key.vbpubk) Root key (public)
($(VBOOT_SOURCE)/tests/devkeys/recovery_key.vbpubk) Recovery key (public)
($(VBOOT_SOURCE)/tests/devkeys/firmware_data_key.vbprivk) Firmware key (private)($(VBOOT_SOURCE)/tests/devkeys/kernel_subkey.vbpubk) Kernel subkey (public)
($(VBOOT_SOURCE)/tests/devkeys/firmware.keyblock) Keyblock to use for the RW regions
</code></pre></div>
</li>
<li>
<p>Build the image again:</p>
<div class="highlight"><pre><span></span><code>./build.sh dev-build $PWD/release/coreboot apu2 CPUS=$(nproc)
</code></pre></div>
</li>
<li>
<p>Flash the new image. The firmware image can be found in
    <code>release/coreboot/build</code> which is relative to cloned <code>pce-fw-builder</code>
    directory.</p>
</li>
</ol>
<h2 id="advantages-of-vboot">Advantages of vboot</h2>
<ol>
<li>
<p>Flashmap layout.</p>
<p>Whole flash is divided into sections describe in an FMD (FlashMap Descriptor)
file (located in <code>src/mainboard/pcengines/apu2</code> directory). Each section has
strictly precised size. This allows to flash only certain flash regions with
flashrom (requires quite fresh compilation of flashrom).</p>
<p>Flashing a single region, for example RW_SECTION_A:</p>
<div class="highlight"><pre><span></span><code>flashrom -p internal -w coreboot.rom --fmap -i RW_SECTION_A
</code></pre></div>
<blockquote>
<p>Region names are defined in the FMD file.</p>
</blockquote>
</li>
<li>
<p>Verified boot</p>
<p>Each boot component in firmware block A or B (depending which one is correctly
booting) is verified again the keys that signed the blocks and the root key
which public part lies in the recovery region. Only the firmware signed by the
keys that belong to the cryptographical keychain (established during key
generation) is allowed to boot. If the signatures are not matching, another
firmware slot is used (also must pass verification). If everything else fails,
boot from recovery. Recovery partition aka read-only is supposed to be
protected by SPI flash protection mechanism as it make the Root of Trust.</p>
<blockquote>
<p>Note that firmware components signed by different keyset won't work. If You
change the keys, flash whole firmware.</p>
</blockquote>
</li>
<li>
<p>Measured boot</p>
<p>By utlizing TPM capabilities, each boot component is cryptographically measured
i.e. its hash is computed and extended in TPM's PCR (Platform Configuration
Register). The hash is not directly written into PCR, but extended, which means
that TPM takes current PCR value, add the hash value of the component and
rehashes the combined value. The final result is written to PCR. Such approach
has the advantage that the final PCR values after boot process is finished are
fixed. In other words, by measuring the same components, in same order, without
any changes in its content we are able to obtain same PCR values. There is no
other way to obtain the same result if any of the components changed, or if the
measuring order has been altered. Given that, the PCR values can clearly assure
that the firmware has not been tampered.</p>
</li>
</ol>
<h3 id="how-to-check-it-works">How to check it works</h3>
<p>In order to verify whether vboot and TPM works, one has to compile the cbmem
utility:</p>
<div class="highlight"><pre><span></span><code>cd $PWD/release/coreboot/util/cbmem
make
</code></pre></div>
<p>And copy the cbmem executable to the apu2 platform booted with vboot support.
Dump the bootlog to a file:</p>
<div class="highlight"><pre><span></span><code>./cbmem -c &gt; bootconsole.log
</code></pre></div>
<p>And analyze it. You should see similar messages:</p>
<div class="highlight"><pre><span></span><code>Phase 1
FMAP: area GBB found @ 505000 (978944 bytes)
VB2:vb2_check_recovery() Recovery reason from previous boot: 0x0 / 0x0
Phase 2
Phase 3
FMAP: area GBB found @ 505000 (978944 bytes)
FMAP: area VBLOCK_A found @ a0000 (65536 bytes)
FMAP: area VBLOCK_A found @ a0000 (65536 bytes)
VB2:vb2_verify_keyblock() Checking key block signature...
FMAP: area VBLOCK_A found @ a0000 (65536 bytes)
FMAP: area VBLOCK_A found @ a0000 (65536 bytes)
VB2:vb2_verify_fw_preamble() Verifying preamble.
Phase 4
FMAP: area FW_MAIN_A found @ b0000 (2228160 bytes)
VB2:vb2api_init_hash() HW crypto for hash_alg 2 not supported, using SW
tlcl_extend: response is 0
tlcl_extend: response is 0
tlcl_lock_nv_write: response is 0
Slot A is selected
creating vboot_handoff structure
</code></pre></div>
<p>And the measurements made during boot process:</p>
<div class="highlight"><pre><span></span><code> PCR-2 51d3adcb927807324651c102e5e07d8085b66bae944f37d4de3d89d6118a595f SHA256 [FMAP: COREBOOT CBFS: bootblock]
 PCR-2 fd582fcb2af6ff4e703b2398df919f94c9c3bbcb675429a1414646d123ab141d SHA256 [FMAP: COREBOOT CBFS: fallback/romstage]
 PCR-0 2547cc736e951fa4919853c43ae890861a3b3264 SHA1 [GBB flags]
 PCR-1 a66c8c2cda246d332d0c2025b6266e1e23c89410051002f46bfad1c9265f43d0 SHA256 [GBB HWID]
 PCR-2 a5e02cf99b58d52493d295dca701fdefe3cfc0afa901a70475c2de20603984e7 SHA256 [FMAP: FW_MAIN_A CBFS: fallback/ramstage]
 PCR-3 269138dedbdc3d6d236212392fb18d29aefce116586c5f058419a214efa866a1 SHA256 [FMAP: FW_MAIN_A CBFS: bootorder]
 PCR-3 269138dedbdc3d6d236212392fb18d29aefce116586c5f058419a214efa866a1 SHA256 [FMAP: FW_MAIN_A CBFS: bootorder]
 PCR-3 269138dedbdc3d6d236212392fb18d29aefce116586c5f058419a214efa866a1 SHA256 [FMAP: FW_MAIN_A CBFS: bootorder]
 PCR-2 6c1d20616d91442b61de89de6bf81f0ee8e929919c9284061e00d004de893994 SHA256 [FMAP: COREBOOT CBFS: spd.bin]
 PCR-3 787ba3c5d060991254426794207f64eefe825f93cdebc00f24e7ca0f2acceae9 SHA256 [PSPDIR]
 PCR-2 ca09ef53266de8a9f95a70b28279fdab4d8d21c48d12f6f20ebba9685adc2168 SHA256 [FMAP: COREBOOT CBFS: AGESA]
 PCR-2 ca09ef53266de8a9f95a70b28279fdab4d8d21c48d12f6f20ebba9685adc2168 SHA256 [FMAP: COREBOOT CBFS: AGESA]
 PCR-2 ca09ef53266de8a9f95a70b28279fdab4d8d21c48d12f6f20ebba9685adc2168 SHA256 [FMAP: COREBOOT CBFS: AGESA]
 PCR-2 ca09ef53266de8a9f95a70b28279fdab4d8d21c48d12f6f20ebba9685adc2168 SHA256 [FMAP: COREBOOT CBFS: AGESA]
 PCR-2 ca09ef53266de8a9f95a70b28279fdab4d8d21c48d12f6f20ebba9685adc2168 SHA256 [FMAP: COREBOOT CBFS: AGESA]
 PCR-2 ca09ef53266de8a9f95a70b28279fdab4d8d21c48d12f6f20ebba9685adc2168 SHA256 [FMAP: COREBOOT CBFS: AGESA]
 PCR-2 ca09ef53266de8a9f95a70b28279fdab4d8d21c48d12f6f20ebba9685adc2168 SHA256 [FMAP: COREBOOT CBFS: AGESA]
 PCR-2 6f51a6e4ea6f26b2a5ae619421d0942515db9977c6136a4a6b3d2759b2616143 SHA256 [FMAP: FW_MAIN_A CBFS: fallback/dsdt.aml]
 PCR-3 269138dedbdc3d6d236212392fb18d29aefce116586c5f058419a214efa866a1 SHA256 [FMAP: FW_MAIN_A CBFS: bootorder]
 PCR-2 a6b195044628cf787c9006c3f8a520a0d3fce1df2566fa1ce0294ecc5daf0441 SHA256 [FMAP: FW_MAIN_A CBFS: fallback/payload]
</code></pre></div>
<blockquote>
<p>Some components are listed few times, because access to them is made several
times. Each time component is accessed from flash, it is measured.</p>
</blockquote>
<p>As one can see the logs contain the PCR number that has been extended, the hash
value, used hashing algorithm and then the component name and location that the
measurement is corresponding to.</p>
<p>The final PCR numbers can be checked with <code>tpm2-tools</code>. It is pretty hard to
compile them, so there is a prepared docker container that has already the
tools compiled. Refer to <a href="https://github.com/3mdeb/tpm2-tools-docker">3mdeb/tpm2-tools-docker.</a></p>
<p>To check PCRs:</p>
<div class="highlight"><pre><span></span><code>docker run --privileged --rm -it 3mdeb/tpm2-tools-docker tpm2_pcrlist
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.60a45f97.min.js"></script>
      
    
  </body>
</html>