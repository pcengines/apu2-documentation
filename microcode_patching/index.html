
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="http://pcengines.github.io/apu2-documentation/microcode_patching/">
      
      
        <link rel="prev" href="../linux_issues/">
      
      
        <link rel="next" href="../mpcie_modules/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>Microcode patching on PC Engines apu2/3/4/5 - apu2 Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a40c8224.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#microcode-patching-on-pc-engines-apu2345" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="apu2 Documentation" class="md-header__button md-logo" aria-label="apu2 Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            apu2 Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Microcode patching on PC Engines apu2/3/4/5
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="apu2 Documentation" class="md-nav__button md-logo" aria-label="apu2 Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    apu2 Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../apu_CPU_boost/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    APU Core Performance Boost
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../apu_ecc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Issues with ECC enabling
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../apu_flashing_ipxe/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PC Engines APUx flashing with iPXE usage
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../apu_flashing_with_rpi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flashing APUx with Raspberry Pi
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../APU_mPCIe_capabilities/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    APU mPCIe capabilities
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../apu2_vboot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vboot measured boot on apu2
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../apu2_vs_apu3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Apu2 vs apu3
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../apu2_vs_apu4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Apu2 vs apu4
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cbmem_building/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coreboot cbmem building
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cold_reset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Performing cold reset remotely
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../firmware_flashing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Firmware flashing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../flashrom_building/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flashrom building
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../generating_coreboot_support_logs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generating coreboot support logs and sending them for verification purposes
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../gpios/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    APU GPIO tutorial
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ipxe_compile/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ipxe compile
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../linux_issues/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Known issues with Linux
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Microcode patching on PC Engines apu2/3/4/5
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Microcode patching on PC Engines apu2/3/4/5
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#user-guide" class="md-nav__link">
    <span class="md-ellipsis">
      User guide
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../mpcie_modules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    List of supported mPCIe modules
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../order_of_PCI_addresses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Order of PCI addresses
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../os_boot_serial_console/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Enabling OS boot serial console and setting connection parameters
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../os-status/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tested operating systems
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../pfsense_installerconfig/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unattended installation PFSense
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../pfSense-install-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pfSense Installation Guide
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../pxelinux-cfg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pxelinux cfg
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_process/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Release process
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sd_card_performance_test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sd card performance test
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../serial_console/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Serial console output in coreboot
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../supported_coreboot_build/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building firmware supported by coreboot
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../theory-of-operation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    apu features - theory of operation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tianocore_build/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coreboot with tianocore payload on apu2
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tpm_menu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SeaBIOS TPM configuration menu
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tpm_pin_mapping/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pin mapping
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../voyage_image_building_alix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building Voyage Linux image for PC Engines ALIX platforms
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../voyage_linux_netinst/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuring Voyage Linux netinst
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../voyage_linux_sd_card_install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Voyage linux sd card install
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../power_consumption_testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Power Consumption Testing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_37" >
        
          
          <label class="md-nav__link" for="__nav_37" id="__nav_37_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    debug
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_37_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_37">
            <span class="md-nav__icon md-icon"></span>
            debug
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/AGESA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AGESA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/alix3d2_issue/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Issue description of PC Engines ALIX2D3 board
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/cpu_frequency/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debug notes for CPU frequency issues
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/debian_kernel_rebuild/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debian kernel rebuild
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/external_sd_slot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    External sd slot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/freeDOS_problems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Problems with FreeDOS on APU2 platform
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/hdd_mPCIe_log_analyze/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hdd mPCIe log analyze
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/hdd_test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hdd test
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/iommu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AMD I/O Virtualization Technology (IOMMU)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/mpcie_ethernet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mpcie ethernet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/mpcie1_mpcie2_ethernet_card/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Problems with APU2 when using Mini PCI-Express Dual Gigabit Ethernet Controller Card
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/mpcie2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ASM1061 in the J13 slot problems
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/openwrt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Openwrt booting from SD card issue
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/pfsense-ahci-issue/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pfSense installation tests
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/sd_registers_bad/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sd registers bad
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/sdcard_debug/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sdcard debug
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/sdcard_test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sdcard test
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/tplink_hg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tplink hg
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/tpm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TPM support for apu platforms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/usb-debugging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    apu2 USB xHCi debugging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/usb-sticks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    USB sticks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/usb-tests/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    USB tests
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/warmboot_reset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Doubled sign of life
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_38" >
        
          
          <label class="md-nav__link" for="__nav_38" id="__nav_38_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    research
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_38_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_38">
            <span class="md-nav__icon md-icon"></span>
            research
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../research/apu_bios_write_protect/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BIOS write protect
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../research/early-cbmem-implementation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Early cbmem implementation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../research/fast_boot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PC Engines fast boot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../research/freebsd_tpm_support/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FreeBSD TPM2.0 support
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../research/geode_lx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ALIX and AMD Geode LX
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../research/Orange_Pi_flasher/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Orange Pi flasher
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../research/power-consumption-tests/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PC Engines apu3 power consumption tests
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../research/ROCA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ROCA TPM vulnerability verification and status
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../research/RPI_SPI_flasher/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RPI flasher
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../research/tpm2-triage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Report of TPM2 support
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../research/USB_compliance_test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    USB compliance tests
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#user-guide" class="md-nav__link">
    <span class="md-ellipsis">
      User guide
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="microcode-patching-on-pc-engines-apu2345">Microcode patching on PC Engines apu2/3/4/5</h1>
<p>With v4.8.0.7 release we have implemented an experimental feature of microcode
patching. Inspired by <a href="https://github.com/pcengines/apu2-documentation/issues/75">community</a>
we decided to add such feature to the PC Engines firmware.</p>
<p>The first implementation did not work as expected unfortunately. The procedure
patched only BSP core leaving APs unpatched and AGESA was overwriting the patch
with its own microcode in one of initialization phases.</p>
<p>Thus we have redesigned the feature to overwrite the microcode patch.</p>
<h2 id="user-guide">User guide</h2>
<p>To build the firmware from scratch and add microcode patch follow the
steps:</p>
<ol>
<li>Clone the <a href="https://github.com/pcengines/pce-fw-builder">pce-fw-builder</a></li>
<li>
<p>Pull or <a href="https://github.com/pcengines/pce-fw-builder#building-docker-image">build</a>
    docker container:</p>
<div class="highlight"><pre><span></span><code>docker pull pcengines/pce-fw-builder
</code></pre></div>
<p>or for legacy:</p>
<div class="highlight"><pre><span></span><code>docker pull pcengines/pce-fw-builder-legacy
</code></pre></div>
</li>
<li>
<p>Build v4.8.0.7 image (v4.0.22 for legacy):</p>
<div class="highlight"><pre><span></span><code>./build.sh release v4.8.0.7 {apu2|apu3|apu4|apu5}
</code></pre></div>
</li>
<li>
<p>Download the <a href="https://github.com/platomav/CPUMicrocodes/raw/master/AMD/cpu00730F01_ver07030106_2018-02-09_88EDFAA0.bin">microcode patch</a>
    and place it in <code>release/coreboot</code> which is relative to cloned <code>pce-fw-builder</code>
    directory.</p>
</li>
<li>
<p>Make changes to menuconfig:</p>
<div class="highlight"><pre><span></span><code>./build.sh dev-build $PWD/release/coreboot {apu2|apu3|apu4|apu5} menuconfig
</code></pre></div>
<p>In the Chipset submenu find <code>Include CPU microcode in CBFS</code> and choose
<code>Add microcode patch for AMD fam16h (EXPERIMENTAL)</code> option. Then in the
Chipset submenu fill the <code>Microcode binary path and filename</code> field with
<code>cpu00730F01_ver07030106_2018-02-09_88EDFAA0.bin</code> which was downloaded in
previous step. If the binary has been renamed, please fill the renamed binary
here. Path is relative to coreboot root directory. When finished, save the
config file.</p>
</li>
<li>
<p>Build the image again:</p>
<div class="highlight"><pre><span></span><code>./build.sh dev-build $PWD/release/coreboot {apu2|apu3|apu4|apu5} CPUS=$(nproc)
</code></pre></div>
</li>
<li>
<p>Flash the new image. The firmware image can be found in
    <code>release/coreboot/build</code> which is relative to cloned <code>pce-fw-builder</code>
    directory.</p>
</li>
</ol>
<h2 id="summary">Summary</h2>
<p>By default the microcode patch level is <code>0x07030105</code> according to dmesg reports
on Linux system. So v4.8.0.7 release binary will show:</p>
<div class="highlight"><pre><span></span><code>microcode: CPU0: patch_level=0x07030105
microcode: CPU1: patch_level=0x07030105
microcode: CPU2: patch_level=0x07030105
microcode: CPU3: patch_level=0x07030105
</code></pre></div>
<p>After successfully building and flashing the image, dmesg should show:</p>
<div class="highlight"><pre><span></span><code>microcode: CPU0: patch_level=0x07030106
microcode: CPU1: patch_level=0x07030106
microcode: CPU2: patch_level=0x07030106
microcode: CPU3: patch_level=0x07030106
</code></pre></div>
<p>Also when checking the vulnerability status with <a href="https://github.com/speed47/spectre-meltdown-checker">spectre-meltdown-checker</a>
one can notice that following fields have changed:</p>
<p>With microcode patch:</p>
<div class="highlight"><pre><span></span><code>* PRED_CMD MSR is available:  YES
* CPU indicates IBPB capability:  YES  (IBPB_SUPPORT feature bit)
...
* IBPB enabled and active:  YES
</code></pre></div>
<p>Without microcode patch:</p>
<div class="highlight"><pre><span></span><code>* PRED_CMD MSR is available:  NO
* CPU indicates IBPB capability:  NO
...
* IBPB enabled and active:  NO
</code></pre></div>
<blockquote>
<p>Load <code>msr</code> kernel module before launching the script.</p>
</blockquote>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.60a45f97.min.js"></script>
      
    
  </body>
</html>